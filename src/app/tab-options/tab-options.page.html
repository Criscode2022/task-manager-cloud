<ion-header>
  <ion-toolbar>
    <ion-button
      aria-label="delete button"
      slot="start"
      class="invisible ion-margin"
    >
      <ion-icon name="trash-outline"></ion-icon>
    </ion-button>
    <ion-title class="lg:relative lg:left-4 ion-text-center">
      Task Manager
    </ion-title>
    <ion-button
      aria-label="information button"
      slot="end"
      id="info-alert"
      color="primary"
      class="ion-margin w-20"
    >
      <ion-icon name="information"></ion-icon>
    </ion-button>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <img
    src="assets/background-image.svg"
    class="absolute bottom-10 right-2 opacity-20"
    alt="soft background image of a girl and sunflowers"
  />

  <p class="m-4 font-bold">Save your tasks to the cloud</p>

  <ng-container *ngIf="userId(); else btnSave">
    <ng-container *ngTemplateOutlet="btnUpload"></ng-container>
  </ng-container>

  @if (loading()) {
  <ion-spinner aria-label="loading spinner" name="crescent"></ion-spinner>

  } @if (userId() && !loading()) {

  <div class="px-4 py-6">
    <p class="px-4"><strong>Your user ID : {{userId()}}</strong></p>
    <p class="px-4">Use this user ID to sync your tasks on any device</p>
  </div>
  } @if (messageUpload() && !loading()) {

  <div class="p-8">
    <strong class="text-red-600">{{messageUpload()}}</strong>
  </div>
  }

  <p class="m-4 font-bold">Get your tasks from the cloud</p>

  <ion-button
    aria-label="download button"
    color="primary"
    id="download-alert"
    class="p-4"
  >
    <ion-icon name="cloud-download"></ion-icon>
  </ion-button>

  @if (messageDownload() === 'success') {

  <div class="p-8">
    <strong class="text-green-700"> Tasks downloaded correctly! </strong>
  </div>

  } @if (messageDownload() === 'not found') {

  <div class="p-8">
    <strong class="text-red-700"> User ID doesn't exist </strong>
  </div>

  } @if (messageDownload() === 'error') {

  <div class="p-8">
    <strong class="text-red-600"> Server error, please try again </strong>
  </div>
  }

  <ion-alert
    trigger="download-alert"
    header="Import tasks"
    message="IMPORTANT: This will OVERWRITE your current tasks"
    [buttons]="alertButtonsDownload"
    [inputs]="alertInputs"
  ></ion-alert>

  <ion-alert
    trigger="info-alert"
    header="Information"
    message="Once you have an user ID, tasks are automatically synced when you open the app or make changes, but you can also manually upload and download tasks"
    [buttons]="alertButtonsInfo"
  ></ion-alert>
</ion-content>

<!---------------------------------------------------------------->

<ng-template #btnSave>
  <ion-button
    aria-label="upload button"
    color="primary"
    (click)="upload()"
    class="p-4"
  >
    <ion-icon name="save"></ion-icon> </ion-button
></ng-template>

<ng-template #btnUpload>
  <ion-button
    aria-label="upload button"
    color="primary"
    id="upload-alert"
    class="p-4"
  >
    <ion-icon name="save"></ion-icon>
  </ion-button>

  <ion-alert
    trigger="upload-alert"
    header="Upload tasks"
    message="IMPORTANT: This will OVERWRITE the tasks saved in the cloud with your user ID"
    [buttons]="alertButtonsUpload"
  ></ion-alert>
</ng-template>
