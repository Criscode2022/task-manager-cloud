<ion-header class="ion-no-border">
  <ion-toolbar class="toolbar-gradient lg:py-2">
    <ion-button slot="start" class="invisible ion-margin">
      <ion-icon name="trash-outline"></ion-icon>
    </ion-button>
    <ion-title
      routerLink="/"
      class="lg:fixed lg:top-1/2 lg:left-1/2 lg:-translate-x-1/2 lg:-translate-y-1/2 ion-text-center cursor-pointer hover:opacity-80 transition-opacity text-2xl lg:text-4xl font-extrabold tracking-tight"
    >
      <span class="title-gradient">Settings</span>
    </ion-title>
    <ion-button
      aria-label="information button"
      slot="end"
      id="info-alert"
      fill="clear"
      class="ion-margin toolbar-button lg:text-xl"
      matTooltip="Help & Information"
      matTooltipPosition="below"
    >
      <ion-icon name="help-circle-outline"></ion-icon>
    </ion-button>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="content-background">
  <img
    src="assets/background-image.svg"
    class="background-decoration"
    alt="soft background image of a girl and sunflowers"
  />

  <div class="settings-container">
    <!-- Status Badge -->
    <div class="status-badge fade-in-subtle">
      @if (!userId() && !isLoading()) {
        <ion-chip color="warning" class="status-chip">
          <ion-icon name="cloud-offline-outline"></ion-icon>
          <ion-label>Offline Mode</ion-label>
        </ion-chip>
      }
      @if (userId() && !isLoading()) {
        <ion-chip color="success" class="status-chip">
          <ion-icon name="cloud-done-outline"></ion-icon>
          <ion-label>Connected</ion-label>
        </ion-chip>
      }
    </div>

    <!-- Loading State -->
    @if (isLoading()) {
      <div class="loading-container">
        <ion-spinner aria-label="loading spinner" name="crescent" color="primary"></ion-spinner>
        <p class="loading-text">Loading...</p>
      </div>
    }

    @if (!isLoading()) {
      <!-- Cloud Sync Section -->
      <div class="settings-section fade-in-subtle" style="animation-delay: 0.05s">
        <div class="section-header">
          <ion-icon name="cloud-outline" class="section-icon"></ion-icon>
          <h2 class="section-title">Cloud Sync</h2>
        </div>

        <ion-card class="settings-card">
          @if (!userId()) {
            <!-- Upload Tasks -->
            <div class="card-item">
              <div class="card-content">
                <h3 class="card-title">Upload Tasks</h3>
                <p class="card-description">Sync your local tasks to the cloud</p>
              </div>
              <ion-button
                aria-label="upload button"
                color="primary"
                (click)="uploadTasks()"
                class="action-button"
              >
                <ion-icon slot="icon-only" name="cloud-upload-outline"></ion-icon>
              </ion-button>
            </div>
          }

          @if (userId()) {
            <!-- User Info Card -->
            <div class="card-item user-info">
              <div class="card-content">
                <h3 class="card-title">User ID</h3>
                <p class="card-id">{{userId()}}</p>
              </div>
              <ion-button
                aria-label="offline button"
                id="offline-alert"
                fill="clear"
                class="action-button"
                matTooltip="Go offline"
              >
                <ion-icon name="cloud-offline-outline"></ion-icon>
              </ion-button>
            </div>
          }

          <!-- Login/Switch Account -->
          <div class="card-item">
            <div class="card-content">
              <h3 class="card-title">{{!userId() ? 'Login with PIN' : 'Switch Account'}}</h3>
              <p class="card-description">{{!userId() ? 'Sign in to sync your tasks' : 'Login with a different PIN'}}</p>
            </div>
            <ion-button
              aria-label="login button"
              color="primary"
              id="download-alert"
              class="action-button"
            >
              <ion-icon slot="icon-only" name="{{!userId() ? 'log-in-outline' : 'swap-horizontal-outline'}}"></ion-icon>
            </ion-button>
          </div>
        </ion-card>
      </div>

      <!-- Account Management Section -->
      @if (userId()) {
        <div class="settings-section fade-in-subtle" style="animation-delay: 0.1s">
          <div class="section-header">
            <ion-icon name="person-outline" class="section-icon"></ion-icon>
            <h2 class="section-title">Account</h2>
          </div>

          <ion-card class="settings-card danger-card">
            <div class="card-item">
              <div class="card-content">
                <h3 class="card-title text-danger">Delete Account</h3>
                <p class="card-description">Permanently remove your user ID and cloud data</p>
              </div>
              <ion-button
                aria-label="delete button"
                color="danger"
                id="delete-user-alert"
                class="action-button"
              >
                <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
              </ion-button>
            </div>
          </ion-card>
        </div>
      }

      <!-- Appearance Section -->
      <div class="settings-section fade-in-subtle" style="animation-delay: 0.15s">
        <div class="section-header">
          <ion-icon name="color-palette-outline" class="section-icon"></ion-icon>
          <h2 class="section-title">Appearance</h2>
        </div>

        <ion-card class="settings-card">
          <div class="card-item">
            <div class="card-content">
              <h3 class="card-title">Dark Mode</h3>
              <p class="card-description">Toggle between light and dark theme</p>
            </div>
            <ion-toggle
              [checked]="isDark()"
              (ionChange)="themeService.switchTheme()"
              class="modern-toggle"
            ></ion-toggle>
          </div>
        </ion-card>
      </div>
    }
  </div>

  <!-- Alerts -->
  <ion-alert
    trigger="offline-alert"
    [header]="'Confirmation'"
    [message]="alertMessages.GoOfflineAlert"
    [buttons]="offlineButtons"
  ></ion-alert>

  <ion-alert
    trigger="download-alert"
    header="Login with PIN"
    message="Enter your 4-digit PIN to sync your tasks"
    [buttons]="alertButtonsDownload"
    [inputs]="alertInputs"
  ></ion-alert>

  <ion-alert
    trigger="info-alert"
    header="Information"
    [message]="alertMessages.InfoAlert"
    [buttons]="alertButtonsInfo"
  ></ion-alert>

  <ion-alert
    trigger="delete-user-alert"
    header="Delete User ID"
    [message]="alertMessages.DeleteUserAlert"
    [buttons]="alertButtonsDelete"
  ></ion-alert>
</ion-content>
